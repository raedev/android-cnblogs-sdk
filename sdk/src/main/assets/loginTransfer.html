<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <title>博客园登录</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
          name="viewport"/>
    <link href="bootstrap.min.css" rel="stylesheet"/>
    <style>
        .center-block {
            padding-top: 10rem;
            text-align: center;
        }
        
        .btn {
            margin-top: 20px;
            width: 100%;
        }
        
        .btn-primary {
            color: #fff;
            background-color: #3fa2f8;
            border-color: #3fa2f8;
        }
        
        .text {
            margin-top: 16px;
        }

    </style>
</head>

<body>
<div class="container">
    <!-- 正在登录 -->
    <div class="center-block" id="code0">
        <img src="bars.svg" width="40px"/>
        <p class="text text-muted">校验登录信息，请稍后...</p>
        <a class="btn btn-default" href="javascript:cnblogs.reload()" role="button">返回登录</a>
    </div>
    <!-- 登录成功 -->
    <div class="center-block" id="code200">
        <img height="120px" src="loginSuccess.png"/>
        <p class="text text-success" style="margin-top: 32px; font-size: 16px">欢迎回来，<b id="author">游客</b>
        </p>
        <p class="text text-muted" style="margin-top: 12px; font-size: 14px"><b id="time">5</b>秒后自动关闭页面
        </p>
        <a class="btn btn-primary" href="javascript:cnblogs.back()" role="button"
           style="margin-top: 80px">立即进入</a>
    </div>
    <!-- 登录失败 -->
    <div class="center-block" id="code500">
        <img height="120px" src="loginFailed.png"/>
        <p class="text text-danger" id="msg"
           style="margin-top: 32px; font-size: 16px; word-break: break-all">
            登录失败
        </p>
        <a class="btn btn-danger" href="javascript:cnblogs.reload()" role="button">返回登录</a>
        <a class="btn btn-primary" href="javascript:cnblogs.clearCache()" role="button">清除缓存重试</a>
    </div>
</div>

<script type="text/javascript">
        function onPageLoad() {
            var querys = location.search.replace('?', '').split('&')
            var code = '0'
            var msg = ''
            for (var index in querys) {
                var item = querys[index]
                var keyValue = item.split('=')
                if (keyValue.length < 2) continue
                var key = keyValue[0]
                var value = keyValue[1]
                if (key == 'code') code = value
                if (key == 'msg') msg = decodeURIComponent(value)
            }
            var boxs = document.getElementsByClassName('center-block')
            for (var index in boxs) {
                var item = boxs[index]
                if (typeof item != 'object') {
                    continue
                }
                var key = 'code' + code
                if (item.id == key) {
                    item.style.display = 'block'
                } else {
                    item.style.display = 'none'
                }
                console.log(item.id)
            }

            if (code == 200 && msg) {
                var obj = JSON.parse(msg)
                document.getElementById('author').innerText = obj.displayName
                var time = 4
                var timer = setInterval(() => {
                    if (time == 0) {
                        clearInterval(timer)
                        cnblogs.back()
                        return
                    }
                    document.getElementById('time').innerText = Math.max(0, time--)
                }, 1000)
            } else if (code == 500) {
                document.getElementById('msg').innerText = msg
            }
        }

        onPageLoad()

</script>
</body>

</html>